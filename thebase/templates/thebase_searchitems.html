{% extends 'thebase_base_template.html' %}
{% load thebasefilters %}
{% load humanize %}
{% block title %}
  BASE ITEMS
{% endblock %}

{% block thebase_content_style %}
  <style>
    div.table-responsive {
      width: 100%;
      height: 70vh;
    }
    table td {
      white-space: nowrap;
      
    }
    img.thumbnail {
      width: 100px;
    }
    table#id_item_table thead th { position: sticky; top: 0; }
  </style>
{% endblock %}

{% block thebase_content %}
<form class="form-inline">
  <input type="hidden" name="action" value="search">
    <div class="form-group">
    <label for="id-itemname">q(スペース区切り):</label>
    <div class="ml-2 mr-2">
      <input type="text" name="q" class="form-control" id="id-q" value="{{ q | default_if_none:'' }}">
    </div>
  </div>
    <button type="submit" class="btn btn-primary">検索</button>
</form>
{% if search_result.error %}
  {{ search_result.error.code }} {{ search_result.error.message }}
{% elif search_result.items != None %}
  
  {% if search_result.items|length == 0 %}
    該当する商品が見つかりませんでした
  {% else %}

  {{ search_result.items|length }}件ヒットしました
  <form class="form-inline" method="get" action="{% url 'thebase:delete' %}">
    <div class="form-group my-2">
      <label for="id_operation">操作</label>
      <select name="operation" id="id_operation" class="form-control">
        <option value="delete">削除</option>
      </select>
      <button type="submit" class="btn btn-warning">実行</button>
    </div>
    <div class="table-responsive">
      <table id="id_item_table" class="table table-bordered table-striped mt-2">
        <thead class="thead-dark">
          <th>
            <input type="checkbox" id="id_check_all" class="">
          </th>
          <th>
            img1_origin
          </th>
          <th>
            itemid
          </th>
          <th>
            title
          </th>
          <th>
            detail
          </th>
          <th>
            price
          </th>
          <th>
            proper_price
          </th>
          <th>
            item_tax_type
          </th>
          <th>
            stock
          </th>
          <th>
            visible
          </th>
          <th>
            list_order
          </th>
          <th>
            identifier
          </th>
         
          <th>
            modified
          </th>
          <th>
            variations
          </th>
        </thead>
        <tbody>
          {% for object in search_result.items %}
            <tr>
              <td>
                <input type="checkbox" class="form-control select-checkbox" name="selected_items[]" value="{{ object.item_id }}">
              </td>
              <td>
                <img src="{{ object.img1_origin }}" class="thumbnail">
                {% include 'thebase_searchitems_images_modal.html' with images=object.images %}
                <button class="image-modal-open btn btn-primary">全て表示</button>
              </td>
              <td>
                {{ object.item_id }}
              </td>
              <td>
                {{ object.title }}
              </td>
              <td>
                {% include 'thebase_searchitems_detail_modal.html' with object=object %}
                <button class="modal-open btn btn-primary" type="button">表示</button>
              </td>
              <td>
                {{ object.price|intcomma }}
              </td>
              <td>
                {{ object.proper_price|default_if_none:'-' }}
              </td>
              <td>
                {{ object.item_tax_type |tax_type }}
              </td>
              <td>
                {{ object.stock }}
              </td>
              <td>
                {{ object.visible_readable }}
              </td>
              <td>
                {{ object.list_order }}
              </td>
              <td>
                {{ object.identifier|default_if_none:'-' }}
              </td>
              
              <td>
                {{ object.modified | todatetime | date:"Y/n/j H:i:s"  }}
              </td>
              <td>
                <table class="table table-sm">
                  <thead>
                    <th>id</th>
                    <th>variation</th>
                    <th>stock</th>
                  </thead>
                  <tbody>
                    {% for var in object.variations %}
                    <tr>

                      <td>
                        {{ var.variation_id }}
                      </td>
                      
                      <td>
                        {{ var.variation }}
                      </td>
                      <td>
                        {{ var.variation_stock }}
                      </td>
                      
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </td>
              
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </form>
  {% endif %}
  {% endif %}
{% endblock %}
{% block thebase_script %}
<script>
  $(function () {
    var $checkbox = $('.select-checkbox');
    var $check_all = $('#id_check_all');
    $check_all.on('change', function() {
      $checkbox.prop('checked', $(this).prop('checked'));
    });
  });
</script>
{% endblock %}
